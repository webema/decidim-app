"use strict";var G=Object.defineProperty;var m=(i,o)=>G(i,"name",{value:o,configurable:!0});var _=require("./codemirror.cjs.js");require("./show-hint.cjs.js");var l=require("graphql"),t=require("./index.cjs.js"),M=require("./Range.cjs.js"),V=require("./onlineParser.cjs.js"),K=require("./introspection.cjs.js");require("react");require("react-dom");function B(i){let o;return P(i,r=>{switch(r.kind){case"Query":case"ShortQuery":case"Mutation":case"Subscription":case"FragmentDefinition":o=r;break}}),o}m(B,"getDefinitionState");function h(i,o,r){return r===K.SchemaMetaFieldDef.name&&i.getQueryType()===o?K.SchemaMetaFieldDef:r===K.TypeMetaFieldDef.name&&i.getQueryType()===o?K.TypeMetaFieldDef:r===K.TypeNameMetaFieldDef.name&&l.isCompositeType(o)?K.TypeNameMetaFieldDef:"getFields"in o?o.getFields()[r]:null}m(h,"getFieldDef");function P(i,o){const r=[];let n=i;for(;n!=null&&n.kind;)r.push(n),n=n.prevState;for(let e=r.length-1;e>=0;e--)o(r[e])}m(P,"forEachState");function S(i){const o=Object.keys(i),r=o.length,n=new Array(r);for(let e=0;e<r;++e)n[e]=i[o[e]];return n}m(S,"objectValues");function R(i,o){return Q(o,U(i.string))}m(R,"hintList");function Q(i,o){if(!o)return O(i,n=>!n.isDeprecated);const r=i.map(n=>({proximity:w(U(n.label),o),entry:n}));return O(O(r,n=>n.proximity<=2),n=>!n.entry.isDeprecated).sort((n,e)=>(n.entry.isDeprecated?1:0)-(e.entry.isDeprecated?1:0)||n.proximity-e.proximity||n.entry.label.length-e.entry.label.length).map(n=>n.entry)}m(Q,"filterAndSortList");function O(i,o){const r=i.filter(o);return r.length===0?i:r}m(O,"filterNonEmpty");function U(i){return i.toLowerCase().replace(/\W/g,"")}m(U,"normalizeText");function w(i,o){let r=Y(o,i);return i.length>o.length&&(r-=i.length-o.length-1,r+=i.indexOf(o)===0?0:.5),r}m(w,"getProximity");function Y(i,o){let r,n;const e=[],d=i.length,a=o.length;for(r=0;r<=d;r++)e[r]=[r];for(n=1;n<=a;n++)e[0][n]=n;for(r=1;r<=d;r++)for(n=1;n<=a;n++){const c=i[r-1]===o[n-1]?0:1;e[r][n]=Math.min(e[r-1][n]+1,e[r][n-1]+1,e[r-1][n-1]+c),r>1&&n>1&&i[r-1]===o[n-2]&&i[r-2]===o[n-1]&&(e[r][n]=Math.min(e[r][n],e[r-2][n-2]+c))}return e[d][a]}m(Y,"lexicalDistance");const j={command:"editor.action.triggerSuggest",title:"Suggestions"},J=m(i=>{const o=[];if(i)try{l.visit(l.parse(i),{FragmentDefinition(r){o.push(r)}})}catch{return[]}return o},"collectFragmentDefs");function q(i,o,r,n,e,d){var a;const c=Object.assign(Object.assign({},d),{schema:i}),s=n||re(o,r),u=s.state.kind==="Invalid"?s.state.prevState:s.state;if(!u)return[];const f=u.kind,v=u.step,g=ae(i,s.state);if(f===t.RuleKinds.DOCUMENT)return R(s,[{label:"query",kind:t.CompletionItemKind.Function},{label:"mutation",kind:t.CompletionItemKind.Function},{label:"subscription",kind:t.CompletionItemKind.Function},{label:"fragment",kind:t.CompletionItemKind.Function},{label:"{",kind:t.CompletionItemKind.Constructor}]);if(f===t.RuleKinds.IMPLEMENTS||f===t.RuleKinds.NAMED_TYPE&&((a=u.prevState)===null||a===void 0?void 0:a.kind)===t.RuleKinds.IMPLEMENTS)return W(s,u,i,o,g);if(f===t.RuleKinds.SELECTION_SET||f===t.RuleKinds.FIELD||f===t.RuleKinds.ALIASED_FIELD)return H(s,g,c);if(f===t.RuleKinds.ARGUMENTS||f===t.RuleKinds.ARGUMENT&&v===0){const p=g.argDefs;if(p)return R(s,p.map(T=>{var E;return{label:T.name,insertText:T.name+": ",command:j,detail:String(T.type),documentation:(E=T.description)!==null&&E!==void 0?E:void 0,kind:t.CompletionItemKind.Variable,type:T.type}}))}if((f===t.RuleKinds.OBJECT_VALUE||f===t.RuleKinds.OBJECT_FIELD&&v===0)&&g.objectFieldDefs){const p=S(g.objectFieldDefs),T=f===t.RuleKinds.OBJECT_VALUE?t.CompletionItemKind.Value:t.CompletionItemKind.Field;return R(s,p.map(E=>{var I;return{label:E.name,detail:String(E.type),documentation:(I=E.description)!==null&&I!==void 0?I:void 0,kind:T,type:E.type}}))}if(f===t.RuleKinds.ENUM_VALUE||f===t.RuleKinds.LIST_VALUE&&v===1||f===t.RuleKinds.OBJECT_FIELD&&v===2||f===t.RuleKinds.ARGUMENT&&v===2)return z(s,g,o,i);if(f===t.RuleKinds.VARIABLE&&v===1){const p=l.getNamedType(g.inputType),T=x(o,i,s);return R(s,T.filter(E=>E.detail===(p==null?void 0:p.name)))}return f===t.RuleKinds.TYPE_CONDITION&&v===1||f===t.RuleKinds.NAMED_TYPE&&u.prevState!=null&&u.prevState.kind===t.RuleKinds.TYPE_CONDITION?X(s,g,i):f===t.RuleKinds.FRAGMENT_SPREAD&&v===1?Z(s,g,i,o,Array.isArray(e)?e:J(e)):f===t.RuleKinds.VARIABLE_DEFINITION&&v===2||f===t.RuleKinds.LIST_TYPE&&v===1||f===t.RuleKinds.NAMED_TYPE&&u.prevState&&(u.prevState.kind===t.RuleKinds.VARIABLE_DEFINITION||u.prevState.kind===t.RuleKinds.LIST_TYPE||u.prevState.kind===t.RuleKinds.NON_NULL_TYPE)?ie(s,i):f===t.RuleKinds.DIRECTIVE?te(s,u,i):[]}m(q,"getAutocompleteSuggestions");const L=` {
  $1
}`,$=m(i=>{const o=i.type;return l.isCompositeType(o)||l.isListType(o)&&l.isCompositeType(o.ofType)||l.isNonNullType(o)&&(l.isCompositeType(o.ofType)||l.isListType(o.ofType)&&l.isCompositeType(o.ofType.ofType))?L:null},"getInsertText");function H(i,o,r){var n;if(o.parentType){const e=o.parentType;let d=[];return"getFields"in e&&(d=S(e.getFields())),l.isCompositeType(e)&&d.push(l.TypeNameMetaFieldDef),e===((n=r==null?void 0:r.schema)===null||n===void 0?void 0:n.getQueryType())&&d.push(l.SchemaMetaFieldDef,l.TypeMetaFieldDef),R(i,d.map((a,c)=>{var s;const u={sortText:String(c)+a.name,label:a.name,detail:String(a.type),documentation:(s=a.description)!==null&&s!==void 0?s:void 0,deprecated:Boolean(a.deprecationReason),isDeprecated:Boolean(a.deprecationReason),deprecationReason:a.deprecationReason,kind:t.CompletionItemKind.Field,type:a.type},f=$(a);return f&&(u.insertText=a.name+f,u.insertTextFormat=t.InsertTextFormat.Snippet,u.command=j),u}))}return[]}m(H,"getSuggestionsForFieldNames");function z(i,o,r,n){const e=l.getNamedType(o.inputType),d=x(r,n,i).filter(a=>a.detail===e.name);if(e instanceof l.GraphQLEnumType){const a=e.getValues();return R(i,a.map(c=>{var s;return{label:c.name,detail:String(e),documentation:(s=c.description)!==null&&s!==void 0?s:void 0,deprecated:Boolean(c.deprecationReason),isDeprecated:Boolean(c.deprecationReason),deprecationReason:c.deprecationReason,kind:t.CompletionItemKind.EnumMember,type:e}}).concat(d))}else if(e===l.GraphQLBoolean)return R(i,d.concat([{label:"true",detail:String(l.GraphQLBoolean),documentation:"Not false.",kind:t.CompletionItemKind.Variable,type:l.GraphQLBoolean},{label:"false",detail:String(l.GraphQLBoolean),documentation:"Not true.",kind:t.CompletionItemKind.Variable,type:l.GraphQLBoolean}]));return d}m(z,"getSuggestionsForInputValues");function W(i,o,r,n,e){if(o.needsSeparator)return[];const d=r.getTypeMap(),a=S(d).filter(l.isInterfaceType),c=a.map(({name:p})=>p),s=new Set;C(n,(p,T)=>{var E,I,N,D,y;if(T.name&&(T.kind===t.RuleKinds.INTERFACE_DEF&&!c.includes(T.name)&&s.add(T.name),T.kind===t.RuleKinds.NAMED_TYPE&&((E=T.prevState)===null||E===void 0?void 0:E.kind)===t.RuleKinds.IMPLEMENTS)){if(e.interfaceDef){if((I=e.interfaceDef)===null||I===void 0?void 0:I.getInterfaces().find(({name:A})=>A===T.name))return;const k=r.getType(T.name),F=(N=e.interfaceDef)===null||N===void 0?void 0:N.toConfig();e.interfaceDef=new l.GraphQLInterfaceType(Object.assign(Object.assign({},F),{interfaces:[...F.interfaces,k||new l.GraphQLInterfaceType({name:T.name,fields:{}})]}))}else if(e.objectTypeDef){if((D=e.objectTypeDef)===null||D===void 0?void 0:D.getInterfaces().find(({name:A})=>A===T.name))return;const k=r.getType(T.name),F=(y=e.objectTypeDef)===null||y===void 0?void 0:y.toConfig();e.objectTypeDef=new l.GraphQLObjectType(Object.assign(Object.assign({},F),{interfaces:[...F.interfaces,k||new l.GraphQLInterfaceType({name:T.name,fields:{}})]}))}}});const u=e.interfaceDef||e.objectTypeDef,v=((u==null?void 0:u.getInterfaces())||[]).map(({name:p})=>p),g=a.concat([...s].map(p=>({name:p}))).filter(({name:p})=>p!==(u==null?void 0:u.name)&&!v.includes(p));return R(i,g.map(p=>{const T={label:p.name,kind:t.CompletionItemKind.Interface,type:p};return p!=null&&p.description&&(T.documentation=p.description),T}))}m(W,"getSuggestionsForImplements");function X(i,o,r,n){let e;if(o.parentType)if(l.isAbstractType(o.parentType)){const d=l.assertAbstractType(o.parentType),a=r.getPossibleTypes(d),c=Object.create(null);a.forEach(s=>{s.getInterfaces().forEach(u=>{c[u.name]=u})}),e=a.concat(S(c))}else e=[o.parentType];else{const d=r.getTypeMap();e=S(d).filter(l.isCompositeType)}return R(i,e.map(d=>{const a=l.getNamedType(d);return{label:String(d),documentation:(a==null?void 0:a.description)||"",kind:t.CompletionItemKind.Field}}))}m(X,"getSuggestionsForFragmentTypeConditions");function Z(i,o,r,n,e){if(!n)return[];const d=r.getTypeMap(),a=B(i.state),c=ne(n);e&&e.length>0&&c.push(...e);const s=c.filter(u=>d[u.typeCondition.name.value]&&!(a&&a.kind===t.RuleKinds.FRAGMENT_DEFINITION&&a.name===u.name.value)&&l.isCompositeType(o.parentType)&&l.isCompositeType(d[u.typeCondition.name.value])&&l.doTypesOverlap(r,o.parentType,d[u.typeCondition.name.value]));return R(i,s.map(u=>({label:u.name.value,detail:String(d[u.typeCondition.name.value]),documentation:`fragment ${u.name.value} on ${u.typeCondition.name.value}`,kind:t.CompletionItemKind.Field,type:d[u.typeCondition.name.value]})))}m(Z,"getSuggestionsForFragmentSpread");const ee=m((i,o)=>{var r,n,e,d,a,c,s,u,f,v;if(((r=i.prevState)===null||r===void 0?void 0:r.kind)===o)return i.prevState;if(((e=(n=i.prevState)===null||n===void 0?void 0:n.prevState)===null||e===void 0?void 0:e.kind)===o)return i.prevState.prevState;if(((c=(a=(d=i.prevState)===null||d===void 0?void 0:d.prevState)===null||a===void 0?void 0:a.prevState)===null||c===void 0?void 0:c.kind)===o)return i.prevState.prevState.prevState;if(((v=(f=(u=(s=i.prevState)===null||s===void 0?void 0:s.prevState)===null||u===void 0?void 0:u.prevState)===null||f===void 0?void 0:f.prevState)===null||v===void 0?void 0:v.kind)===o)return i.prevState.prevState.prevState.prevState},"getParentDefinition");function x(i,o,r){let n=null,e;const d=Object.create({});return C(i,(a,c)=>{if((c==null?void 0:c.kind)===t.RuleKinds.VARIABLE&&c.name&&(n=c.name),(c==null?void 0:c.kind)===t.RuleKinds.NAMED_TYPE&&n){const s=ee(c,t.RuleKinds.TYPE);s!=null&&s.type&&(e=o.getType(s==null?void 0:s.type))}n&&e&&(d[n]||(d[n]={detail:e.toString(),insertText:r.string==="$"?n:"$"+n,label:n,type:e,kind:t.CompletionItemKind.Variable},n=null,e=null))}),S(d)}m(x,"getVariableCompletions");function ne(i){const o=[];return C(i,(r,n)=>{n.kind===t.RuleKinds.FRAGMENT_DEFINITION&&n.name&&n.type&&o.push({kind:t.RuleKinds.FRAGMENT_DEFINITION,name:{kind:l.Kind.NAME,value:n.name},selectionSet:{kind:t.RuleKinds.SELECTION_SET,selections:[]},typeCondition:{kind:t.RuleKinds.NAMED_TYPE,name:{kind:l.Kind.NAME,value:n.type}}})}),o}m(ne,"getFragmentDefinitions");function ie(i,o,r){const n=o.getTypeMap(),e=S(n).filter(l.isInputType);return R(i,e.map(d=>({label:d.name,documentation:d.description,kind:t.CompletionItemKind.Variable})))}m(ie,"getSuggestionsForVariableDefinition");function te(i,o,r,n){var e;if(!((e=o.prevState)===null||e===void 0)&&e.kind){const d=r.getDirectives().filter(a=>oe(o.prevState,a));return R(i,d.map(a=>({label:a.name,documentation:a.description||"",kind:t.CompletionItemKind.Function})))}return[]}m(te,"getSuggestionsForDirective");function re(i,o){let r=null,n=null,e=null;const d=C(i,(a,c,s,u)=>{if(u===o.line&&a.getCurrentPosition()>=o.character)return r=s,n=Object.assign({},c),e=a.current(),"BREAK"});return{start:d.start,end:d.end,string:e||d.string,state:n||d.state,style:r||d.style}}m(re,"getTokenAtPosition");function C(i,o){const r=i.split(`
`),n=V.onlineParser();let e=n.startState(),d="",a=new M.CharacterStream("");for(let c=0;c<r.length;c++){for(a=new M.CharacterStream(r[c]);!a.eol()&&(d=n.token(a,e),o(a,e,d,c)!=="BREAK"););o(a,e,d,c),e.kind||(e=n.startState())}return{start:a.getStartOfToken(),end:a.getCurrentPosition(),string:a.current(),state:e,style:d}}m(C,"runOnlineParser");function oe(i,o){var r;if(!i||!i.kind)return!1;const n=i.kind,e=o.locations;switch(n){case t.RuleKinds.QUERY:return e.indexOf(l.DirectiveLocation.QUERY)!==-1;case t.RuleKinds.MUTATION:return e.indexOf(l.DirectiveLocation.MUTATION)!==-1;case t.RuleKinds.SUBSCRIPTION:return e.indexOf(l.DirectiveLocation.SUBSCRIPTION)!==-1;case t.RuleKinds.FIELD:case t.RuleKinds.ALIASED_FIELD:return e.indexOf(l.DirectiveLocation.FIELD)!==-1;case t.RuleKinds.FRAGMENT_DEFINITION:return e.indexOf(l.DirectiveLocation.FRAGMENT_DEFINITION)!==-1;case t.RuleKinds.FRAGMENT_SPREAD:return e.indexOf(l.DirectiveLocation.FRAGMENT_SPREAD)!==-1;case t.RuleKinds.INLINE_FRAGMENT:return e.indexOf(l.DirectiveLocation.INLINE_FRAGMENT)!==-1;case t.RuleKinds.SCHEMA_DEF:return e.indexOf(l.DirectiveLocation.SCHEMA)!==-1;case t.RuleKinds.SCALAR_DEF:return e.indexOf(l.DirectiveLocation.SCALAR)!==-1;case t.RuleKinds.OBJECT_TYPE_DEF:return e.indexOf(l.DirectiveLocation.OBJECT)!==-1;case t.RuleKinds.FIELD_DEF:return e.indexOf(l.DirectiveLocation.FIELD_DEFINITION)!==-1;case t.RuleKinds.INTERFACE_DEF:return e.indexOf(l.DirectiveLocation.INTERFACE)!==-1;case t.RuleKinds.UNION_DEF:return e.indexOf(l.DirectiveLocation.UNION)!==-1;case t.RuleKinds.ENUM_DEF:return e.indexOf(l.DirectiveLocation.ENUM)!==-1;case t.RuleKinds.ENUM_VALUE:return e.indexOf(l.DirectiveLocation.ENUM_VALUE)!==-1;case t.RuleKinds.INPUT_DEF:return e.indexOf(l.DirectiveLocation.INPUT_OBJECT)!==-1;case t.RuleKinds.INPUT_VALUE_DEF:switch((r=i.prevState)===null||r===void 0?void 0:r.kind){case t.RuleKinds.ARGUMENTS_DEF:return e.indexOf(l.DirectiveLocation.ARGUMENT_DEFINITION)!==-1;case t.RuleKinds.INPUT_DEF:return e.indexOf(l.DirectiveLocation.INPUT_FIELD_DEFINITION)!==-1}}return!1}m(oe,"canUseDirective");function ae(i,o){let r,n,e,d,a,c,s,u,f,v,g;return P(o,p=>{var T;switch(p.kind){case t.RuleKinds.QUERY:case"ShortQuery":v=i.getQueryType();break;case t.RuleKinds.MUTATION:v=i.getMutationType();break;case t.RuleKinds.SUBSCRIPTION:v=i.getSubscriptionType();break;case t.RuleKinds.INLINE_FRAGMENT:case t.RuleKinds.FRAGMENT_DEFINITION:p.type&&(v=i.getType(p.type));break;case t.RuleKinds.FIELD:case t.RuleKinds.ALIASED_FIELD:{!v||!p.name?a=null:(a=f?h(i,f,p.name):null,v=a?a.type:null);break}case t.RuleKinds.SELECTION_SET:f=l.getNamedType(v);break;case t.RuleKinds.DIRECTIVE:e=p.name?i.getDirective(p.name):null;break;case t.RuleKinds.INTERFACE_DEF:p.name&&(s=null,g=new l.GraphQLInterfaceType({name:p.name,interfaces:[],fields:{}}));break;case t.RuleKinds.OBJECT_TYPE_DEF:p.name&&(g=null,s=new l.GraphQLObjectType({name:p.name,interfaces:[],fields:{}}));break;case t.RuleKinds.ARGUMENTS:{if(!p.prevState)n=null;else switch(p.prevState.kind){case t.RuleKinds.FIELD:n=a&&a.args;break;case t.RuleKinds.DIRECTIVE:n=e&&e.args;break;case t.RuleKinds.ALIASED_FIELD:{const y=(T=p.prevState)===null||T===void 0?void 0:T.name;if(!y){n=null;break}const b=f?h(i,f,y):null;if(!b){n=null;break}n=b.args;break}default:n=null;break}break}case t.RuleKinds.ARGUMENT:if(n){for(let y=0;y<n.length;y++)if(n[y].name===p.name){r=n[y];break}}c=r==null?void 0:r.type;break;case t.RuleKinds.ENUM_VALUE:const E=l.getNamedType(c);d=E instanceof l.GraphQLEnumType?E.getValues().find(y=>y.value===p.name):null;break;case t.RuleKinds.LIST_VALUE:const I=l.getNullableType(c);c=I instanceof l.GraphQLList?I.ofType:null;break;case t.RuleKinds.OBJECT_VALUE:const N=l.getNamedType(c);u=N instanceof l.GraphQLInputObjectType?N.getFields():null;break;case t.RuleKinds.OBJECT_FIELD:const D=p.name&&u?u[p.name]:null;c=D==null?void 0:D.type;break;case t.RuleKinds.NAMED_TYPE:p.name&&(v=i.getType(p.name));break}}),{argDef:r,argDefs:n,directiveDef:e,enumValue:d,fieldDef:a,inputType:c,objectFieldDefs:u,parentType:f,type:v,interfaceDef:g,objectTypeDef:s}}m(ae,"getTypeInfo");_.CodeMirror.registerHelper("hint","graphql",(i,o)=>{const r=o.schema;if(!r)return;const n=i.getCursor(),e=i.getTokenAt(n),d=e.type!==null&&/"|\w/.test(e.string[0])?e.start:e.end,a=new M.Position(n.line,d),s={list:q(r,i.getValue(),a,e,o.externalFragments).map(u=>({text:u.label,type:u.type,description:u.documentation,isDeprecated:u.isDeprecated,deprecationReason:u.deprecationReason})),from:{line:n.line,ch:d},to:{line:n.line,ch:e.end}};return(s==null?void 0:s.list)&&s.list.length>0&&(s.from=_.CodeMirror.Pos(s.from.line,s.from.ch),s.to=_.CodeMirror.Pos(s.to.line,s.to.ch),_.CodeMirror.signal(i,"hasCompletion",i,s,e)),s});
