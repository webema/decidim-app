import{find as t,findOne as e,on as o}from"domassist";import s from"attrobj";import i from"aug";function d(t){return t.parentNode?JSON.parse(JSON.stringify(t.parentNode.dataset)).module?t.parentNode:d(t.parentNode):t}const n={find:t,findOne:e,on:o};class r{constructor(t,e=""){return this.log("begin setup"),this.el=t,this.els={},this.options=i({},this.defaults,s("module",this.el)),this.moduleName=e||this.el.dataset.module,this.setUps={actions:[],named:[],options:[]},this.boundActionRouter=this.actionRouter.bind(this),this.preInit(),this.storeRef(),this.setupActions(),this.setupNamed(),this.verifyRequired(),this.postInit(),this.log("initalized"),r.debug&&(this.el.module=this),this}preInit(){}postInit(){}get required(){return{}}get defaults(){return{}}get uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}verifyRequired(){return this.required==={}||(void 0!==this.required.options&&(this.setUps.options=Object.keys(this.options)),Object.keys(this.required).forEach(t=>{this.required[t].forEach(e=>{if(this.setUps[t].indexOf(e)<0)throw new Error(`${e} is required as ${t} for ${this.moduleName}, but is missing!`)})})),this}setupActions(){this.setupAction(this.el),this.find("[data-action]").forEach(t=>{d(t)===this.el&&this.setupAction(t)})}setupAction(t){if("true"===t.dataset.domoduleActionProcessed)return;const{name:e,type:o}=r.parseAction(t);e&&("function"==typeof this[e]?(this.log(`${e} bound`),this.storeSetUp(e,"actions"),n.on(t,o,this.boundActionRouter),t.dataset.domoduleActionProcessed="true"):this.log(`${e} was registered, but there is no function set up`))}actionRouter(t){const e=t.currentTarget,{name:o}=r.parseAction(e),i=s("action",e);this[o].call(this,e,t,i)}setupNamed(){this.find("[data-name]").forEach(t=>{d(t)===this.el&&(t.dataset.domoduleNameProcessed||(this.els[t.dataset.name]=t,this.storeSetUp(t.dataset.name,"named"),t.dataset.domoduleNameProcessed="true",t.dataset.domoduleOwner=this.id))})}storeRef(){if(void 0===window.domorefs&&(window.domorefs={}),void 0!==window.domorefs[this.el.dataset.moduleUid])return!1;this.id=this.uuid,this.el.dataset.moduleUid=this.id,window.domorefs[this.el.dataset.moduleUid]=this}find(t){return n.find(t,this.el)}findOne(t){return n.findOne(t,this.el)}findByName(t){return this.els[t]}getOption(t){return this.options[t]}storeSetUp(t,e){this.setUps[e].indexOf(t)<0&&this.setUps[e].push(t)}destroy(){n.find("[data-action]",this.el.parentNode).forEach(t=>{if("true"===t.dataset.domoduleActionProcessed){const{type:e}=r.parseAction(t);t.removeEventListener(e,this.boundActionRouter),t.dataset.domoduleActionProcessed="false"}})}static parseAction(t){const{action:e,actionType:o="click"}=t.dataset;return{name:e,type:o}}static getInstance(t){if(t instanceof Node)return window.domorefs[t.dataset.moduleUid];throw new Error("getInstance expects a dom node")}static register(t,e){"function"==typeof t&&(t=(e=t).prototype.constructor.name),window.domodules||(window.domodules={}),r.log(`Registering ${t}`),window.domodules[t]=e}static discover(t="body"){if(r.log("Discovering modules..."),!window.domodules)return void r.log("No modules found");let e;e=t instanceof Node?[t]:Array.isArray(t)?t:n.find(t);const o=[];return e.forEach(t=>{n.find("[data-module]",t).forEach(t=>{const e=t.dataset.module;if(e&&"function"==typeof window.domodules[e]){if("object"==typeof window.domorefs&&void 0!==window.domorefs[t.dataset.moduleUid])return;r.log(`${e} found`),o.push(new window.domodules[e](t))}})}),o}log(t){r.log(`${this.constructor.name}: ${t}`)}static log(t){r.debug&&console.log(`[DOMODULE] ${t}`)}}r.debug="object"==typeof window.localStorage&&window.localStorage.getItem("DomoduleDebug"),r.autoDiscover=!0,window.addEventListener("DOMContentLoaded",()=>{r.autoDiscover&&r.discover()});export default r;
//# sourceMappingURL=domodule.modern.js.map
