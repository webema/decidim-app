!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("domassist"),require("attrobj"),require("aug")):"function"==typeof define&&define.amd?define(["domassist","attrobj","aug"],t):(e||self).domodule=t(e.domassist,e.attrobj,e.aug)}(this,function(e,t,o){function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=i(t),s=i(o);function d(e){return e.parentNode?JSON.parse(JSON.stringify(e.parentNode.dataset)).module?e.parentNode:d(e.parentNode):e}var r="[data-action]",u={find:e.find,findOne:e.findOne,on:e.on},a=function(){function e(t,o){return void 0===o&&(o=""),this.log("begin setup"),this.el=t,this.els={},this.options=s.default({},this.defaults,n.default("module",this.el)),this.moduleName=o||this.el.dataset.module,this.setUps={actions:[],named:[],options:[]},this.boundActionRouter=this.actionRouter.bind(this),this.preInit(),this.storeRef(),this.setupActions(),this.setupNamed(),this.verifyRequired(),this.postInit(),this.log("initalized"),e.debug&&(this.el.module=this),this}var t,o=e.prototype;return o.preInit=function(){},o.postInit=function(){},o.verifyRequired=function(){var e=this;return this.required==={}||(void 0!==this.required.options&&(this.setUps.options=Object.keys(this.options)),Object.keys(this.required).forEach(function(t){e.required[t].forEach(function(o){if(e.setUps[t].indexOf(o)<0)throw new Error(o+" is required as "+t+" for "+e.moduleName+", but is missing!")})})),this},o.setupActions=function(){var e=this;this.setupAction(this.el),this.find(r).forEach(function(t){d(t)===e.el&&e.setupAction(t)})},o.setupAction=function(t){if("true"!==t.dataset.domoduleActionProcessed){var o=e.parseAction(t),i=o.name,n=o.type;i&&("function"==typeof this[i]?(this.log(i+" bound"),this.storeSetUp(i,"actions"),u.on(t,n,this.boundActionRouter),t.dataset.domoduleActionProcessed="true"):this.log(i+" was registered, but there is no function set up"))}},o.actionRouter=function(t){var o=t.currentTarget,i=e.parseAction(o).name,s=n.default("action",o);this[i].call(this,o,t,s)},o.setupNamed=function(){var e=this;this.find("[data-name]").forEach(function(t){d(t)===e.el&&(t.dataset.domoduleNameProcessed||(e.els[t.dataset.name]=t,e.storeSetUp(t.dataset.name,"named"),t.dataset.domoduleNameProcessed="true",t.dataset.domoduleOwner=e.id))})},o.storeRef=function(){if(void 0===window.domorefs&&(window.domorefs={}),void 0!==window.domorefs[this.el.dataset.moduleUid])return!1;this.id=this.uuid,this.el.dataset.moduleUid=this.id,window.domorefs[this.el.dataset.moduleUid]=this},o.find=function(e){return u.find(e,this.el)},o.findOne=function(e){return u.findOne(e,this.el)},o.findByName=function(e){return this.els[e]},o.getOption=function(e){return this.options[e]},o.storeSetUp=function(e,t){this.setUps[t].indexOf(e)<0&&this.setUps[t].push(e)},o.destroy=function(){var t=this;u.find(r,this.el.parentNode).forEach(function(o){if("true"===o.dataset.domoduleActionProcessed){var i=e.parseAction(o);o.removeEventListener(i.type,t.boundActionRouter),o.dataset.domoduleActionProcessed="false"}})},e.parseAction=function(e){var t=e.dataset,o=t.actionType;return{name:t.action,type:void 0===o?"click":o}},e.getInstance=function(e){if(e instanceof Node)return window.domorefs[e.dataset.moduleUid];throw new Error("getInstance expects a dom node")},e.register=function(t,o){"function"==typeof t&&(t=(o=t).prototype.constructor.name),window.domodules||(window.domodules={}),e.log("Registering "+t),window.domodules[t]=o},e.discover=function(t){if(void 0===t&&(t="body"),e.log("Discovering modules..."),window.domodules){var o;o=t instanceof Node?[t]:Array.isArray(t)?t:u.find(t);var i=[];return o.forEach(function(t){u.find("[data-module]",t).forEach(function(t){var o=t.dataset.module;if(o&&"function"==typeof window.domodules[o]){if("object"==typeof window.domorefs&&void 0!==window.domorefs[t.dataset.moduleUid])return;e.log(o+" found"),i.push(new window.domodules[o](t))}})}),i}e.log("No modules found")},o.log=function(t){e.log(this.constructor.name+": "+t)},e.log=function(t){e.debug&&console.log("[DOMODULE] "+t)},(t=[{key:"required",get:function(){return{}}},{key:"defaults",get:function(){return{}}},{key:"uuid",get:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}])&&function(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}();return a.debug="object"==typeof window.localStorage&&window.localStorage.getItem("DomoduleDebug"),a.autoDiscover=!0,window.addEventListener("DOMContentLoaded",function(){a.autoDiscover&&a.discover()}),a});
//# sourceMappingURL=domodule.umd.js.map
